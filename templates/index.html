async function loadItinerary() {
    const container = document.getElementById("itinerary-container");
    
    try {
        // Show loading state
        container.innerHTML = `
            <div class="loading">
                <div class="spinner"></div>
                <p>Creating your perfect travel plan...</p>
            </div>`;
        
        // Get user ID from URL
        const pathParts = window.location.pathname.split('/').filter(part => part !== '');
        const userId = pathParts[pathParts.length - 1];
        
        if (!userId || isNaN(userId)) {
            throw new Error("Invalid trip ID");
        }
        
        // Fetch itinerary data
        const response = await fetch(`/generate-itinerary/${userId}`);
        
        if (!response.ok) {
            const errorData = await response.json().catch(() => null);
            throw new Error(errorData?.detail || "Failed to load itinerary");
        }
        
        const itinerary = await response.json();
        
        // Update header
        document.getElementById("destination-header").textContent = 
            `Trip to ${itinerary.destination}`;
        document.getElementById("trip-duration").textContent = 
            `${itinerary.duration} day${itinerary.duration > 1 ? 's' : ''} itinerary`;
        
        // Build itinerary HTML using the new structure with "days" instead of "route"
        let html = '';
        itinerary.days.forEach(day => {
            html += `
            <div class="day-card">
                <h2>${day.day}</h2>
                
                <div class="activity">
                    <span class="type">Attractions</span>
                    <div class="place">${day.attractions.join(', ')}</div>
                </div>
                
                <div class="activity">
                    <span class="type">Dining</span>
                    <div class="place">${day.dining.join(', ')}</div>
                </div>
                
                <div class="activity">
                    <span class="type">Activities</span>
                    <div class="place">${day.activities.join(', ')}</div>
                </div>
                
                <div class="activity">
                    <span class="type">Accommodations</span>
                    <div class="place">${day.hotels.join(', ')}</div>
                </div>
            </div>`;
        });
        
        container.innerHTML = html;
        
    } catch (error) {
        console.error("Error:", error);
        container.innerHTML = `
            <div class="error">
                <h3>Error loading itinerary</h3>
                <p>${error.message}</p>
                <button class="retry-btn" onclick="loadItinerary()">
                    Try Again
                </button>
            </div>`;
    }
}